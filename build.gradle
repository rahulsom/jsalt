buildscript {
  repositories {
    jcenter()
    maven { url "http://dl.bintray.com/errbuddy/plugins" }
  }

  dependencies {
    classpath 'com.bertramlabs.plugins:coffee-asset-pipeline:2.6.7'
    classpath 'net.errbuddy.plugins:babel-asset-pipeline:1.3.0'
    classpath 'com.craigburke:typescript-asset-pipeline:0.3.0'
  }
}

plugins {
  id "org.asciidoctor.gradle.asciidoctor" version "1.5.0"
  id 'com.craigburke.bower-installer' version '2.5.1'
  id 'com.craigburke.karma' version '1.4.3'
  id 'com.bertramlabs.asset-pipeline' version '2.6.7'
}

apply plugin: 'java'

repositories {
  jcenter()
}

dependencies {
  compile 'org.slf4j:slf4j-api:1.7.13'

  testCompile 'junit:junit:4.12'

}

bower {
  'lodash'('4.3.0')
}

assets {
  minifyJs = true
  minifyCss = true
  enableSourceMaps = true

  configOptions = [
      typeScript: [
          module:'commonjs',
          target:'es5',
          experimentalDecorators:true
      ]
  ]

  minifyOptions = [
      languageMode: 'ES6',
      targetLanguage: 'ES5',
      optimizationLevel: 'SIMPLE',
      angularPass: true
  ]

  includes = ['facotiral.es5.js']
  excludes = ['bower/**']

  // Can add custom asset locations (directories or individual jar files)
  from 'src/assets/bower'
  // from '/path/to/file.jar'
}

karma {
  basePath = projectDir

  colors = true
  profile 'default'

  browsers = ['PhantomJS']
  frameworks = ['jasmine']
  reporters = ['junit', 'progress', 'coverage']

  preprocessors = [
      'build/assets/**/*.js': ['coverage'],
  ]

  junitReporter = [outputDir: 'build/test-results']

  coverageReporter = [
      dir      : 'build/coverage',
      reporters: [
          [type: 'html', subdir: 'html'],
          [type: 'cobertura', subdir: '.'],
      ]
  ]

  files = [
      "build/assets/bower/**/**",
      "build/assets/**/!(*.spec).unminified.js",
      "build/assets/**/*.spec.unminified.js"
  ]

}
